<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
"http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="cotizacion">

	<typeAlias alias="cotizacionDetalleTicketVueloBean" type="pe.com.paxtravel.bean.CotizacionDetalleTicketVueloBean" />
	<typeAlias alias="fareInfoBean" type="pe.com.paxtravel.bean.FareInfoBean" />	
	<typeAlias alias="cotizacionBean" type="pe.com.paxtravel.bean.CotizacionBean" />
	<typeAlias alias="cotizacionDetalleBean" type="pe.com.paxtravel.bean.CotizacionDetalleBean" />
	<typeAlias alias="ciudadBean" type="pe.com.paxtravel.bean.CiudadBean" />
	<typeAlias alias="paisBean" type="pe.com.paxtravel.bean.PaisBean" />
	<typeAlias alias="motivoViajeBean" type="pe.com.paxtravel.bean.MotivoViajeBean" />
	<typeAlias alias="servicioAdicionalBean" type="pe.com.paxtravel.bean.ServicioAdicionalBean" />
	<typeAlias alias="hotelHabitacionBean" type="pe.com.paxtravel.bean.HotelHabitacionBean" />
	<typeAlias alias="clienteBean" type="pe.com.paxtravel.bean.ClienteBean" />
	<typeAlias alias="cotizacionServicioBean" type="pe.com.paxtravel.bean.CotizacionServicioBean" />
	<typeAlias alias="paqueteResumeBean" type="pe.com.paxtravel.bean.PaqueteResumeBean" />	
	<typeAlias alias="expedienteLogBean" type="pe.com.paxtravel.bean.ExpedienteLogBean" />	
	<!-- Bean Busqueda de Paquetes - Inicio -->	
	<typeAlias alias="paqueteManagerBean" type="pe.com.paxtravel.tree.data.PaqueteManagerBean" />	
	<!-- Bean Busqueda de Paquetes - Fin -->	
	<typeAlias alias="string" type="java.lang.String" />
	
	<typeAlias alias="cotizacionDetalleDestinosBean" type="pe.com.paxtravel.bean.CotizacionDetalleDestinosBean" />
	
	<resultMap id="resultFareInfo" class="fareInfoBean">						
		<result property="comision"		    column="comision" />
		<result property="nombreProveedor" 		    column="proveedor" />
		<result property="nombreAerolinea" 		    column="aerolinea" />	
		<result property="idProveedor" 		    column="id_proveedor" />
		<result property="idAerolinea" 		    column="id_aerolinea" />
	</resultMap>
	
	<resultMap id="resultDestinosDetail" class="cotizacionDetalleBean">	
		<result property="idCotizaDeta"			    column="id_cotiza_deta" />
		<result property="idCotizacion"			    column="id_cotiza" />		
		<result property="desCiudadOrigen"			    column="ciudad_origen" />
		<result property="desCiudadDestino"			    column="ciudad_destino" />
		<result property="isoCiudadOrigen"			    column="iso_origen" />
		<result property="isoCiudadDestino"			    column="iso_destino" />
		<result property="destino"			    column="id_destino" />
		<result property="origen"			    column="id_origen" />	
		<result property="tiIda"			    column="ti_ida" />
		<result property="desTiVuelo"			    column="vuelo" />
		<result property="fechaPartida"			    column="fe_partida" />
		<result property="fechaRetorno"			    column="fe_retorno" />
		<result property="cantidadPasajeros"			    column="cantidad" />		
	</resultMap>

	<resultMap id="resultCotizacion" class="cotizacionBean">
		<result property="numeroFila"			    column="ca_nume_fila" />
		<result property="idCotizacion"			    column="id_cotiza" />
		<result property="numeroCotizacion"		    column="nu_cotiza" />
		<result property="fechaCotizacion" 		    column="fe_cotiza" />
		<result property="nombreCliente" 		    column="cliente" />
		<result property="nombreEstadoCotizacion" 	column="no_estado" />
		<result property="descripcion" 		        column="descripcion" />
		
<!-- 		<result property="tiempoMinimo" 	     	column="tiempo_min" /> -->
<!-- 		<result property="tiempoMaximo" 	    	column="tiempo_max" /> -->
<!-- 		<result property="seguroViaje" 				column="seguro_viaje" /> -->
		<result property="fechaSalida" 	        	column="fe_partida" />
		<result property="fechaRetorno" 			column="fe_retorno" />
		
		<result property="idOrigen" 			column="origen_partida" />
		<result property="idDestino" 			column="id_destino" />
		
<!-- 		<result property="boletoAvion" 				column="boleto_avion" /> -->
		<result property="observacion" 				column="observacion" />
		<result property="tipoAlojamiento" 				column="id_tipo_alojamiento" />
		<result property="categoriaAlojamiento" 				column="id_categoria_alojamiento" />
		<result property="cantidadAdultos" 				column="nu_adultos" />
		<result property="cantidadNinos" 				column="nu_ninos" />
		<result property="presupuestoMinimo" 				column="im_presupuesto_minimo" />
		<result property="presupuestoMaximo" 				column="im_presupuesto_maximo" />
		
		<result property="observacion" 				column="observacion" />
		
	</resultMap>
	
	<resultMap id="resultPais" class="paisBean">
		<result property="idPais"			    column="id_destino" />
		<result property="nomPais"			    column="descripcion" />
	</resultMap>
	
	<resultMap id="resultCotizacionServicio" class="cotizacionServicioBean">
		<result property="idCotiza"			    column="id_cotiza" />
		<result property="idServicio"			    column="id_servicio" />
	</resultMap>
	
	<resultMap id="resultCotizacionServicioAd" class="cotizacionServicioBean">
		<result property="idCotiza"			    column="id_cotiza" />
        <result property="idServicio"			column="id_servicio" /> 		
        <result property="nomServicio"			column="nombre" />		
	</resultMap>
	
	<resultMap id="resultCiudad" class="ciudadBean">
		<result property="idCiudad"			    column="id_destino_ciudad" />
		<result property="idPais"			    column="id_destino_pais" />
		<result property="nomCiudad"			    column="descripcion" />
	</resultMap>
	
	
	<resultMap id="resultCliente" class="clienteBean">
		<result property="idCliente"			    column="id_cliente" />
		<result property="nombre"	        column="nombre_cliente" />
		<result property="age"	        column="age" />
		<result property="email"	        column="email" />
	</resultMap>
	
	
	
	<resultMap id="resultPaquetes" class="paqueteManagerBean">
		<result property="idPaquete"			    column="id_paquete" />
		<result property="nomPaquete"			    column="nombre" />
		<result property="comentario"			    column="observacion" />
		<result property="imPrecio"			    column="im_precio" />
		<result property="tiPresupuestoValue"	column="ti_presupuesto" />
	</resultMap>
	
	<resultMap id="resultPaqueteDestinos" class="paqueteManagerBean">
		<result property="idPaqueteDestino"			    column="id" />
		<result property="idPaquete"			    column="id_destino_ciudad" />		
		<result property="nomPaquete"			    column="nom_ciudad" />
		<result property="nuDias"			    column="nu_dias" />
	</resultMap>		
	
	<resultMap id="resultPaqueteDestinoTour" class="paqueteManagerBean">
		<result property="idPaqueteDestinoTour"			    column="id_paquete_destino_tour" />
		<result property="idPaqueteDestino"			    column="id_paquete_destino" />
		<result property="idTour"			    column="id_tour" />
		<result property="desTour"			    column="descripcion" />
		<result property="imPrecioAdulto"			    column="im_precio_adulto" />
		<result property="imPrecioNino"			    column="im_precio_nino" />
	</resultMap>		
	
	<resultMap id="resultPaqueteDestinoHotel" class="paqueteManagerBean">
		<result property="idPaqueteDestinoHotel"    column="id_paquete_destino_hotel" />
		<result property="idPaqueteDestino"			    column="id_paquete_destino" />
		<result property="idHotel"			    column="id_hotel" />
		<result property="idProveedor"			    column="id_proveedor" />
		<result property="idTipoAlojamiento"			    column="id_tipo_alojamiento" />
		<result property="idCategoriaAlojamiento"			    column="id_categoria_alojamiento" />
		<result property="idHotelHabitacion"			    column="id_hotel_habitacion" />
		<result property="nomTipoAlojamiento"			    column="tipo_alojamiento" />
		<result property="nomProveedor"			    column="proveedor" />
		<result property="nomHotel"			    column="hotel" />
		<result property="nomCategoriaAlojamiento"    column="categoria_alojamiento" />
		<result property="desAlojamiento"			    column="descripcion_alojamiento" />
		<result property="imPrecio"			    column="im_precio" />		
	</resultMap>
	
	<resultMap id="resultPaqueteDestinoTicket" class="paqueteManagerBean">
		 	<result property="idPaqueteTicket"			    column="id_paquete_ticket" />
		 	<result property="idPaquete"			    column="id_paquete_turistico" />
		 	<result property="nomAerolinea"			    column="nom_aerolinea" />
		 	<result property="codeAerolinea"			    column="code_aerolinea" />
		 	<result property="imPrecio"			    column="im_precio" />		 
	</resultMap>
	
	<resultMap id="resultCotizacionResume" class="cotizacionBean">
		<result property="idCotizacion" column="id_cotiza" />
		<result property="idCliente" column="id_cliente" />		
		<result property="numeroCotizacion" column="nu_cotiza" />
		<result property="nombreCliente" column="cliente" />
		<result property="fechaCotizacion" column="fe_cotiza" />		
		<result property="tipoCotizacion" column="cotizacion" />
		<result property="tipoPrograma" column="programa" />
		<result property="estado" column="estado" />
		<result property="tipoAlojamiento" column="alojamiento" />
		<result property="categoriaAlojamiento" column="categoriaAlojamiento" />
		<result property="destinos" column="destinos" />
		<result property="habitaciones" column="habitaciones" />
		<result property="motivos" column="motivos" />
		<result property="servicios" column="servicios" />
		<result property="idTipoCotizacion" column="id_tipo_cotizacion" />
		<result property="idEstado" column="id_estado" />
		<result property="presupuestoMaximo" column="im_presupuesto_maximo" />
		<result property="idTipoAlojamiento" column="id_tipo_alojamiento" />
		<result property="idCategoriaAlojamiento" column="id_categoria_alojamiento" />
		<result property="idTipoPrograma" column="id_tipo_programa" />
		<result property="ticket" column="ticket" />
		<result property="tour" column="tour" />
		<result property="hotel" column="hotel" />
		<result property="cultural" column="cultural" />
		<result property="deportes" column="deportes" />
		<result property="relajacion" column="relajacion" />
		<result property="playa" column="playa" />
	</resultMap>
	
	<resultMap id="resultPaqueteResume" class="paqueteResumeBean">
		<result property="destinos" column="destinos" />
		<result property="tour" column="tour" />
		<result property="hotel" column="hotel" />
		<result property="ticket" column="ticket" />
		<result property="tipoAlojamiento" column="tipoAlojamiento" />
		<result property="categoriaAlojamiento" column="categoriaAlojamiento" />
		<result property="hotelHabitacion" column="hotelHabitacion" />
		<result property="playa" column="playa" />
		<result property="relajacion" column="relajacion" />
		<result property="deportes" column="deportes" />
		<result property="cultural" column="cultural" />
		<result property="playaTour" column="playaTour" />
		<result property="relajacionTour" column="relajacionTour" />
		<result property="deportesTour" column="deportesTour" />
		<result property="culturalTour" column="culturalTour" />
	</resultMap>
	
	<resultMap id="resultPaqueteDetail" class="paqueteResumeBean">
		<result property="idPaquete" column="id_paquete_turistico" />
		<result property="nomPaquete" column="paquete" />
		<result property="imGasto" column="im_gasto" />
		<result property="imPrecio" column="precio" />
		<result property="destinos" column="ciudad" />
		<result property="hotel" column="nomHotel" />
		<result property="tour" column="nomTour" />
		<result property="aerolinea" column="nomAerolinea" />
		<!--  nomAerolinea nomHotel nomTour ciudad gasto precio  id_paquete_turistico  -->
	</resultMap>
	
	 <resultMap id="resultCotizacionById" class="cotizacionBean">
        <result property="idCotizacion"                column="id_cotiza" />
        <result property="numeroCotizacion"            column="nu_cotiza" />
        <result property="fechaCotizacion"             column="fe_cotiza" />
        <result property="fechaSalida"                 column="fe_partida" />
        <result property="observacion"                 column="observacion" />
        <result property="idTipoPrograma" column="id_tipo_programa" />
        <result property="idTipoCotizacion" column="id_tipo_cotiza" />
        <result property="estado" column="no_estado" />
        <result property="idCliente" column="id_cliente" />
        <result property="feMaxAprobCotiza" column="fe_max_aprob_cotiza" />
    </resultMap>
    
    <resultMap id="resultCotPatTurDestinos" class="cotizacionDetalleDestinosBean">
	    <result property="idCotiza"                    column="id_cotiza" />
	    <result property="idCliente"               column="id_cliente" />
	    <result property="idPaqueteTuristico"      column="id_paquete" />
        <result property="nuCotiza"                column="nu_cotiza" />
        <result property="feCotiza"            column="fe_cotiza" />
        <result property="nombresCliente"      column="nombres" />
        <result property="apellidosCliente"        column="apellidos" />
        <result property="tipoDocu"                column="tipo_doc" />
        <result property="nuDocumento"                 column="nu_documento" />
        <result property="fePartida"               column="fe_partida" />
        <result property="feRetorno"               column="fe_retorno" />
        <result property="nombrePaqueteTuristico"  column="nombrePaqueteTuristico" />
        <result property="nuNinos"                     column="nu_ninos" />
        <result property="nuAdultos"               column="nu_adultos" />
        <result property="imPrecio"                column="im_precio" />
        <result property="idPaqueteTuristico"      column="id_paquete_turistico" />
        <result property="descripcionCiudad"       column="descripcion" />
        <result property="nombreProveedor"             column="nombreProveedor" />
        <result property="nomTour"                     column="nomTour" />
        <result property="nomHotel"                column="nomHotel" />
        <result property="nomAerolinea"            column="nomAerolinea" />       
    </resultMap>
    
    <resultMap id="resultCotTicketDestinos" class="cotizacionDetalleDestinosBean">
    	<result property="idCotizaDeta"                column="id_cotiza_deta" />
	    <result property="idCotiza"                column="id_cotiza" />
	    <result property="ciudadOrigen"       column="ciudad_origen" />
	    <result property="ciudadDestino"       column="ciudad_destino" />
	    <result property="isoOrigen"       column="iso_origen" />
	    <result property="isoDestino"       column="iso_destino" />
	    <result property="idOrigen"       column="id_origen" />
	    <result property="idDestino"       column="id_destino" />
	    <result property="tiIda"       column="ti_ida" />
	    <result property="vuelo"       column="vuelo" />
	    <result property="fePartida"       column="fe_partida" />
	    <result property="feRetorno"       column="fe_retorno" />
	    <result property="nuCotiza"                column="nu_cotiza" />
	    <result property="feCotiza"            column="fe_cotiza" />
	    <result property="nombresCliente"      column="nombres" />
        <result property="apellidosCliente"        column="apellidos" />
        <result property="tipoDocu"                column="tipo_doc" />
        <result property="nuDocumento"                 column="nu_documento" />
        <result property="imPrecio"                column="im_precio" />
        <result property="nuNinos"                     column="nu_ninos" />
        <result property="nuAdultos"               column="nu_adultos" />
        <result property="idCliente"               column="id_cliente" />
        <result property="tipoDocu"                column="tipo_doc" />
        <result property="nuDocumento"                 column="nu_documento" />
        <result property="nomAerolinea"            column="nomAerolinea" />
    </resultMap>
    
	<select id="listarCotizacion" parameterClass="cotizacionBean" resultMap="resultCotizacion">
		SELECT  @rownum:=@rownum+1 AS ca_nume_fila, coti.id_cotiza, coti.nu_cotiza,
                DATE_FORMAT(coti.fe_cotiza,'%d-%m-%Y') fe_cotiza,
                CONCAT(clie.nombres,' ',clie.apellidos) cliente, e.no_estado as no_estado,
                coti.descripcion,               
				IF(coti.fe_partida='00-00-0000', NULL, coti.fe_partida) as fe_partida,                 
                IF(coti.fe_retorno='00-00-0000', NULL, coti.fe_retorno) as fe_retorno, 
                coti.observacion,
                coti.origen_partida,				 
				coti.id_cliente, 
				coti.id_estado, 
				coti.id_destino, 
				coti.id_tipo_programa, 
				coti.id_tipo_cotiza, 
				coti.nu_adultos, 
				coti.nu_ninos, 
				coti.id_tipo_alojamiento, 
				coti.id_categoria_alojamiento, 
				coti.im_presupuesto_minimo, 
				coti.im_presupuesto_maximo
          FROM (SELECT @rownum:=0) r, cotizacion coti 
       INNER JOIN cliente clie ON coti.id_cliente=clie.id_cliente   
       INNER JOIN estado as e ON (coti.id_estado=e.id_estado)    
		  WHERE 1 = 1 
	      <isNotEmpty prepend="AND" property="fechaCotizacion"> DATE_FORMAT(coti.fe_cotiza,'%Y-%m-%d')  = #fechaCotizacion# </isNotEmpty>
	      <isNotEmpty prepend="AND" property="numeroCotizacion"> coti.nu_cotiza = #numeroCotizacion# </isNotEmpty> 
	      <isNotEmpty prepend="AND" property="codigoEstadoCotizacion"> coti.id_estado = #codigoEstadoCotizacion# </isNotEmpty> 
	      <isNotEmpty prepend="AND" property="nombreCliente"> CONCAT(clie.nombres,' ',clie.apellidos) LIKE #nombreCliente# </isNotEmpty>
	      <isNotEmpty prepend="AND" property="documentoCliente"> clie.nu_documento = #documentoCliente# </isNotEmpty>
	   ORDER BY coti.id_cotiza DESC
	   LIMIT 20
	</select>
	
	<select id="obtenerNumeroCotizacion" resultClass="string">
		SELECT CONCAT('COTI',
               YEAR(NOW()), 
               IF( LENGTH(MONTH(NOW()))=1,CONCAT('0',MONTH(NOW())),MONTH(NOW()) ),
               MAX( SUBSTR( NU_COTIZA, 11) ) +1 
               ) AS NRO_COTIZA
         FROM COTIZACION;
	</select>
	
	<select id="listarCiudad" parameterClass="ciudadBean" resultMap="resultCiudad">
		SELECT id_destino_ciudad, id_destino_pais, descripcion FROM destino_ciudad 
         WHERE 1=1
		<isNotEmpty prepend="AND" property="idPais"> id_destino_pais = #idPais# </isNotEmpty>
	</select>
	
	<select id="listarCotizacionServicio" parameterClass="cotizacionServicioBean" resultMap="resultCotizacionServicio">
		select id_cotiza,
			   id_servicio
		from cotizacion_servicio
		where id_cotiza = #idCotiza#
		and	  id_servicio = #idServicio# 			
	</select>	
	
	<select id="obtenerCotizacionServicio" parameterClass="cotizacionServicioBean" resultMap="resultCotizacionServicioAd">	
			select cs.id_cotiza,serv.id_servicio,serv.nombre 
			from cotizacion_servicio cs
			inner join servicios serv on cs.id_servicio = serv.id_servicio
			where cs.id_cotiza = #idCotiza#
    </select>  
    
    
	
	
	<select id="listarPais" parameterClass="paisBean" resultMap="resultPais">
		SELECT id_destino, descripcion FROM destino_pais 
		WHERE 1=1
		<isNotEmpty prepend="AND" property="idPais"> id_destino != #idPais# </isNotEmpty>
	</select>	
	
	<insert id="insertarCotizacion" parameterClass="cotizacionBean" >
		INSERT INTO cotizacion(
			nu_cotiza,
			fe_cotiza,			
			fe_partida,
			fe_retorno,
			origen_partida,
			id_tipo_cotiza,
			id_tipo_programa,
			id_tipo_alojamiento,
			id_categoria_alojamiento,
			nu_adultos,
			nu_ninos,
			im_presupuesto_minimo,
			im_presupuesto_maximo,
			observacion,
			id_cliente,
			id_estado,
			fe_ins,
			fe_expiracion_cotiza
		) VALUES (
			#numeroCotizacion#,
			#fechaCotizacion#,						
			#fechaSalida#,
			#fechaRetorno#,
			#idOrigenPartida#,
			#idTipoCotizacion#,
			#idTipoPrograma#,
			#tipoAlojamiento#,
			#categoriaAlojamiento#,
			#cantidadAdultos#,
			#cantidadNinos#,
			#presupuestoMinimo#,
			#presupuestoMaximo#,
			#observacion#,
			#idCliente#,
			#idEstado#,
			sysdate(),
			(SELECT DATE (DATE_ADD(NOW(), INTERVAL (Select value_parametro from `parametros` where id_parametro = 5) DAY) ))
		)
		<selectKey keyProperty="idCotizacion" resultClass="int">
            select LAST_INSERT_ID();
        </selectKey>
	</insert>
	
	<insert id="insertarMotivoViaje" parameterClass="motivoViajeBean">
		INSERT INTO cotizacion_motivo(
			id_cotiza,
			id_motivo
		) VALUES (
			#numeroCotizacion#,
			#codigoMotivo#
		)
	</insert>
	
	<insert id="insertarServicioAdicional" parameterClass="servicioAdicionalBean">
		INSERT INTO cotizacion_servicio(
			id_cotiza,
			id_servicio
		) VALUES (
			#numeroCotizacion#,
			#codigoServicio#
		)
	</insert>
	
	<insert id="insertarCotizacionDetalle" parameterClass="cotizacionDetalleBean">
		INSERT INTO cotizacion_deta(
			id_cotiza,
			id_destino_origen,
			id_destino
		) VALUES (
			#numeroCotizacion#,
			#origen#,
			#destino#
		)
	</insert>
	
	<insert id="insertarCotizacionTicket" parameterClass="cotizacionBean">
		INSERT INTO cotizacion(
			nu_cotiza,
			fe_cotiza,
			descripcion,
			fe_partida,
			fe_retorno,
			nu_adultos,
			nu_ninos,
			id_cliente
		) VALUES (
			#numeroCotizacion#,
			#fechaCotizacion#,
			#descripcion#,
			#fechaSalida#,
			#fechaRetorno#,
			#cantidadAdultos#,
			#cantidadNinos#,
			#idCliente#
		)
	</insert>
	
	<update id="actualizarEstadoCotizacion" parameterClass="cotizacionBean" >
		update cotizacion 
			set id_estado = #idEstado# 			
			<isGreaterThan prepend="," 
			             property="idPaquete" 
			             compareValue="0">
				id_paquete = #idPaquete#, link_cotiza = CONCAT('http://localhost/ProyTravel/?idCotizacion=', #idCotizacion#), fe_link = NOW(),
				im_precio = (SELECT total_gasto as im_precio FROM paquete_turistico where id_paquete = #idPaquete#)
			</isGreaterThan>			
			<isEqual prepend="," property="ticket" compareValue="1">
				im_precio = (SELECT SUM(im_precio) * #cantidadAdultos# as im_precio FROM cotizacion_deta_ticket where id_cotiza = #numeroCotizacion#),
				link_cotiza = CONCAT('http://localhost/ProyTravel/?idCotizacion', #idCotizacion#), fe_link = NOW()				
			</isEqual>
			<isEqual prepend="," property="isAprobado" compareValue="1">
				comentario = #comentario#, fe_upd = NOW()
			</isEqual>
		where id_cotiza = #idCotizacion# 
	</update>

	<insert id="insertarExpedienteLog" parameterClass="expedienteLogBean">
		INSERT INTO expediente_log (ti_log, id_tx, id_user, id_estado, des_log, fe_log, fe_logtime) 
			VALUES (#tiLog#, #idTx#, #idUser#, #idEstado#, #desLog#, NOW(), NOW())
	</insert>
	
	<insert id="insertarCotizacionDetalleTicket" parameterClass="cotizacionDetalleBean">
		INSERT INTO cotizacion_deta(
			id_cotiza,
			id_destino_origen,
			id_destino,
			ti_ida,
			fe_partida,
			fe_retorno			
		) VALUES (
			#numeroCotizacion#,
			#origen#,
			#destino#,
			#tiIda#,
			#fechaPartida#,
			#fechaRetorno#			
		)
	</insert>
		
	<select id="obtenerNombreCliente" parameterClass="clienteBean" resultMap="resultCliente">
		SELECT id_cliente, CONCAT(nombres, ' ', apellidos) AS nombre_cliente, TIMESTAMPDIFF(YEAR,fecha_nac,NOW()) AS age, email  
		  	FROM cliente
         WHERE 1 = 1
	         <isNotEmpty prepend="AND" property="numeroDocumento"> tipo_docu = #tipoDocumento# AND nu_documento = #numeroDocumento# </isNotEmpty>
	         <isGreaterThan prepend="AND" property="idCliente" compareValue="0">
				id_cliente = #idCliente#
			</isGreaterThan>			
	</select>

	<insert id="insertarCotizacionDetalleTicketVueloTab2" parameterClass="cotizacionDetalleTicketVueloBean">
		INSERT INTO cotizacion_deta_ticket(
				id_cotiza_deta,
				id_cotiza,
				id_aerolinea,
				im_precio,
				id_proveedor,
				url_shop,
				im_comision,
				nu_comision,
				id_destino,
				id_origen,
				fe_partida,
				fe_retorno
		) VALUES (
				#idCotizaDeta#,
				#idCotiza#,
				#idAerolinea#,
				#imPrecio#,
				#idProveedor#,
				#urlShop#,
				#imComision#,
				#nuComision#,
				#idDestino#,
				#idOrigen#,
				#fePartida#,
				#feRetorno#
		)
	</insert>
	
	<select id="getConsolidador" parameterClass="fareInfoBean" resultMap="resultFareInfo">
		SELECT  				
				pad.comision,
			    p.nombre as proveedor,
			    a.nombre as aerolinea,
			    p.id_proveedor,
			    a.id_aerolinea                
       FROM 
	       		aerolinea a
				inner join proveedor_aerolinea_destino pad on (a.id_aerolinea = pad.id_aerolinea )
				inner join destino_ciudad d on (d.id_destino_ciudad = pad.id_destino_ciudad)
				inner join proveedor p on (p.id_proveedor = pad.id_proveedor)         
	   WHERE 
				a.code_aerolinea  = #airlineCode# AND 
	   			pad.id_destino_ciudad = #idDestino#	      
	  ORDER BY pad.comision DESC   	    	      
	  LIMIT 1	      
	</select>
	
	<insert id="insertarHabitacionHotel" parameterClass="hotelHabitacionBean">
		INSERT INTO cotizacion_deta_habitacion(
			id_cotiza,
			id_tipo_habitacion,
			nu_habitacion
		) VALUES (
			#idCotiza#,
			#idTipoHabitacion#,
			#nuHabitacion#
		)
	</insert>	
	
	<select id="listarPaqueteDestinos" parameterClass="paqueteManagerBean" resultMap="resultPaqueteDestinos">
		SELECT ptD.id_destino_ciudad as id_destino_ciudad, cD.descripcion AS nom_ciudad, ptD.nu_dias ,
			ptD.id_paquete_destino as id
		FROM paquete_turistico_destino AS ptD 
        	INNER JOIN destino_ciudad AS cD ON (cD.id_destino_ciudad = ptD.id_destino_ciudad)
    	WHERE ptD.id_paquete_turistico = #idPaquete# AND id_destino_ciudad IN 
    		<iterate open="(" close=")" conjunction=",">
			   #list.destino#
			</iterate>
    	 ;
	</select>
	
	<select id="listarPaquete" parameterClass="paqueteManagerBean" resultMap="resultPaquetes">
		SELECT id_paquete, nombre, observacion, #tiPresupuestoValue# AS ti_presupuesto, total_gasto AS im_precio 
			FROM paquete_turistico  
		WHERE id_estado = 5 and id_tipo_paquete = #idTipoPaquete# 
			AND <![CDATA[total_gasto<=#imPrecioMax# and total_gasto>=#imPrecioMin#]]> 		
	</select>
	
	<select id="listarPaqueteDestinoTours" parameterClass="paqueteManagerBean" resultMap="resultPaqueteDestinoTour">
		SELECT id_paquete_destino_tour, id_paquete_destino, id_tour, descripcion, im_precio_adulto, im_precio_nino 
		FROM paquete_turistico_destino_tour
	</select>
	
	<select id="listarPaqueteDestinoHoteles" parameterClass="paqueteManagerBean" resultMap="resultPaqueteDestinoHotel">
		SELECT 
			pTDH.id_paquete_destino_hotel, 
		    pTDH.id_paquete_destino, 
		    pTDH.id_hotel, 
		    pTDH.id_proveedor, 
		    pTDH.id_tipo_alojamiento, 
		    pTDH.id_categoria_alojamiento, 
		    pTDH.id_hotel_habitacion, 
		    tA.descripcion AS tipo_alojamiento,
		    P.nombre AS proveedor,
		    H.descripcion AS hotel,
		    tCA.nombre AS categoria_alojamiento,    	
		    pTDH.descripcion_alojamiento, 
		    pTDH.im_precio     
		FROM paquete_turistico_destino_hotel AS pTDH 
			INNER JOIN proveedor AS P ON (pTDH.id_proveedor = P.id_proveedor)
		    INNER JOIN hotel as H ON (pTDH.id_hotel = H.id_hotel)
		    INNER JOIN tipo_alojamiento as tA ON (tA.id_tipo_alojamiento=pTDH.id_tipo_alojamiento)
		    INNER JOIN tipo_categoria_alojamiento AS tCA ON (pTDH.id_categoria_alojamiento=tCA.id_tipo)
		    INNER JOIN hotel_habitacion AS hH ON (pTDH.id_hotel_habitacion=hH.id_hotel_habitacion) 
	</select>
	
	<select id="listarPaqueteDestinoTickets" parameterClass="paqueteManagerBean" resultMap="resultPaqueteDestinoTicket">
		SELECT 
			pTT.id_paquete_ticket,
			pTT.id_paquete_turistico,
			A.nombre AS nom_aerolinea, 
			A.code_aerolinea,
		    pTT.im_precio
		 FROM paquete_turistico_ticket AS pTT		
		INNER JOIN aerolinea AS A ON (pTT.id_aerolinea = A.id_aerolinea)
		INNER JOIN proveedor AS P ON (pTT.id_proveedor = P.id_proveedor)		
	</select>
		
	<select id="getCotizacionResume" parameterClass="cotizacionBean" resultMap="resultCotizacionResume">	
		SELECT 
			c.nu_cotiza, c.id_cliente, c.id_cotiza, c.fe_cotiza, concat(cli.nombres, ' ',cli.apellidos) AS cliente, tc.nombre AS cotizacion,
			c.id_tipo_cotiza AS id_tipo_cotizacion, 
			c.im_presupuesto_maximo,
			c.id_tipo_alojamiento,
			c.id_categoria_alojamiento,
			c.id_tipo_programa,			
			e.id_estado, 
			tp.nombre AS programa, e.no_estado as estado, ta.descripcion AS alojamiento, tca.nombre AS categoriaAlojamiento,  		
	        GROUP_CONCAT(DISTINCT d.descripcion
						ORDER BY d.descripcion ASC
						SEPARATOR '-') AS destinos,
			GROUP_CONCAT(DISTINCT th.descripcion
						ORDER BY th.descripcion ASC
						SEPARATOR '-') AS habitaciones,
			GROUP_CONCAT(DISTINCT tm.descripcion
						ORDER BY tm.descripcion ASC
						SEPARATOR '-') AS motivos,
			GROUP_CONCAT(DISTINCT s.nombre
						ORDER BY s.nombre ASC
						SEPARATOR '-') AS servicios,
			IfNull((SELECT 1 FROM cotizacion_servicio where id_servicio = 2 AND id_cotiza = c.nu_cotiza),0) AS ticket, 
			IfNull(( SELECT 1 FROM cotizacion_servicio where id_servicio = 3 AND id_cotiza = c.nu_cotiza),0) AS tour,
			IfNull(( SELECT 1 FROM cotizacion_servicio where id_servicio = 6 AND id_cotiza = c.nu_cotiza),0) AS hotel,
			IfNull(( SELECT 1 FROM cotizacion_motivo where id_motivo = 1 AND id_cotiza = c.nu_cotiza),0) AS cultural,
			IfNull(( SELECT 1 FROM cotizacion_motivo where id_motivo = 2 AND id_cotiza = c.nu_cotiza),0) AS deportes,
			IfNull(( SELECT 1 FROM cotizacion_motivo where id_motivo = 3 AND id_cotiza = c.nu_cotiza),0) AS relajacion,
			IfNull(( SELECT 1 FROM cotizacion_motivo where id_motivo = 4 AND id_cotiza = c.nu_cotiza),0) AS playa
		FROM `cotizacion` as c 
			INNER JOIN `cliente` AS cli ON (c.id_cliente = cli.id_cliente)
		    INNER JOIN `tipo_cotizacion` AS tc ON (c.id_tipo_cotiza=tc.id_tipo)    
		    INNER JOIN `estado` AS e ON (e.id_estado=c.id_estado)
		    LEFT JOIN `tipo_alojamiento` AS ta ON (c.id_tipo_alojamiento=ta.id_tipo_alojamiento)
		    LEFT JOIN `tipo_categoria_alojamiento` AS tca ON (c.id_categoria_alojamiento=tca.id_tipo)    
		    LEFT JOIN `tipo_programa` AS tp ON (c.id_tipo_programa=tp.id_programa)    
			LEFT JOIN `cotizacion_deta` AS cd ON (c.nu_cotiza=cd.id_cotiza)
		    LEFT JOIN `cotizacion_deta_habitacion` AS cdh ON (c.nu_cotiza=cdh.id_cotiza)
		    LEFT JOIN `cotizacion_motivo` AS cm ON (c.nu_cotiza=cm.id_cotiza)
		    LEFT JOIN `cotizacion_servicio` AS cs ON (c.nu_cotiza=cs.id_cotiza)
		    LEFT JOIN `tipo_habitacion` AS th ON (cdh.id_tipo_habitacion=th.id_tipo_habitacion)
		    LEFT JOIN `servicios` AS s ON (cs.id_servicio=s.id_servicio)
		    LEFT JOIN `destino_ciudad` AS d ON (cd.id_destino=d.id_destino_ciudad)
		    LEFT JOIN `motivo_viaje` AS tm ON (cm.id_motivo=tm.id_motivo) 
		WHERE
			c.id_cotiza = #idCotizacion#
		GROUP BY c.nu_cotiza
	</select>
	
	<select id="getPaqueteResume" parameterClass="paqueteResumeBean" resultMap="resultPaqueteResume">
		SELECT 
			<!-- destinos / servicios  -->
				IF((SELECT COUNT(*) FROM paquete_turistico_destino AS ptD WHERE ptD.id_paquete_turistico = #idPaquete# AND ptD.id_destino_ciudad IN ( select id_destino from cotizacion_deta where id_cotiza = #numeroCotizacion# ) )=(Select COUNT(*) from cotizacion_deta where id_cotiza = #numeroCotizacion#),
					If((SELECT COUNT(*) FROM paquete_turistico_destino AS ptD WHERE ptD.id_paquete_turistico = #idPaquete#)= (Select COUNT(*) from cotizacion_deta where id_cotiza = #numeroCotizacion#),'Si','No'),'No') AS destinos,
			            
			    (SELECT IF (100/(Select COUNT(*) from `paquete_turistico_destino` where id_paquete_turistico = #idPaquete#)*SUM(IF((SELECT count(*) FROM paquete_turistico_destino_tour where id_destino = ptD.id_destino_ciudad)>0,1,0))>=(Select value_parametro From parametros Where key_parametro = 'CODES'),'Si', 'No') 
					FROM paquete_turistico_destino AS ptD WHERE ptD.id_paquete_turistico = #idPaquete# ) AS tour,
			        
			    (SELECT IF (100/(Select COUNT(*) from `paquete_turistico_destino` where id_paquete_turistico = #idPaquete#)*SUM(IF((SELECT count(*) FROM paquete_turistico_destino_hotel where id_destino = ptD.id_destino_ciudad)>0,1,0))>=(Select value_parametro From parametros Where key_parametro = 'CODES'),'Si', 'No') 
					FROM paquete_turistico_destino AS ptD WHERE ptD.id_paquete_turistico = #idPaquete# ) AS hotel, 
			        
			    (SELECT IF (100/(Select COUNT(*) from `paquete_turistico_destino` where id_paquete_turistico = #idPaquete#)*SUM(IF((SELECT count(*) FROM paquete_turistico_ticket where id_destino_destino = ptD.id_destino_ciudad)>0,1,0))>=(Select value_parametro From parametros Where key_parametro = 'CODES'),'Si', 'No') 
					FROM paquete_turistico_destino AS ptD WHERE ptD.id_paquete_turistico = #idPaquete# ) AS ticket,
			        
			<!-- caracteristicas hotel -->
				if (100/(( Select count(*) from `paquete_turistico_destino` where id_paquete_turistico = #idPaquete# ))*(select 
				count(*)
				from `paquete_turistico_destino_hotel` 	
				where (id_paquete_destino IN ( Select id_paquete_destino from `paquete_turistico_destino` where id_paquete_turistico = #idPaquete# )) 
					AND ( id_tipo_alojamiento = #idTipoAlojamiento# ))>=(Select value_parametro From parametros Where key_parametro = 'COHOT'), 'Si', 'No') AS tipoAlojamiento,
			        
				if (100/(( Select count(*) from `paquete_turistico_destino` where id_paquete_turistico = #idPaquete# ))*(select 
				count(*)
				from `paquete_turistico_destino_hotel` 	
				where (id_paquete_destino IN ( Select id_paquete_destino from `paquete_turistico_destino` where id_paquete_turistico = #idPaquete# )) 
					AND ( id_categoria_alojamiento = #idCategoriaAlojamiento# ))>=(Select value_parametro From parametros Where key_parametro = 'COHOT'), 'Si', 'No') AS categoriaAlojamiento,
			        
			    IF (100/(Select count(*) from `cotizacion_deta_habitacion` where id_cotiza = #numeroCotizacion#)*
					( select count(*) from `paquete_turistico_destino_hotel` where id_paquete = #idPaquete# 
					AND id_hotel_habitacion IN (Select id_tipo_habitacion from `cotizacion_deta_habitacion` where id_cotiza = #numeroCotizacion# )  
				)>= (Select value_parametro From parametros Where key_parametro = 'COHOT'), 'Si', 'No' ) AS hotelHabitacion,
			    
			<!-- motivos destinos -->	
				(Select if (100/count(ptd.id_paquete_turistico)*count(d.flag_playa)>=(Select value_parametro From parametros Where key_parametro = 'COMOD'),'Si', 'No') 
					from `destino_ciudad` as d inner join paquete_turistico_destino as ptd on (ptd.id_destino_ciudad = d.id_destino_ciudad) 
				where ptd.id_paquete_turistico = #idPaquete#) AS playa,            
			        
				(Select if (100/count(ptd.id_paquete_turistico)*count(d.flag_relajacion)>=(Select value_parametro From parametros Where key_parametro = 'COMOD'),'Si', 'No') 
					from `destino_ciudad` as d inner join paquete_turistico_destino as ptd on (ptd.id_destino_ciudad = d.id_destino_ciudad) 
				where ptd.id_paquete_turistico = #idPaquete#) AS relajacion, 
			        
				(Select if (100/count(ptd.id_paquete_turistico)*count(d.flag_deportes)>=(Select value_parametro From parametros Where key_parametro = 'COMOD'),'Si', 'No') 
					from `destino_ciudad` as d inner join paquete_turistico_destino as ptd on (ptd.id_destino_ciudad = d.id_destino_ciudad) 
				where ptd.id_paquete_turistico = #idPaquete#) AS deportes, 
			        
				(Select if (100/count(ptd.id_paquete_turistico)*count(d.flag_cultural)>=(Select value_parametro From parametros Where key_parametro = 'COMOD'),'Si', 'No') 
					from `destino_ciudad` as d inner join paquete_turistico_destino as ptd on (ptd.id_destino_ciudad = d.id_destino_ciudad) 
				where ptd.id_paquete_turistico = #idPaquete#) AS cultural,
			    
			<!-- motivos tour	-->	
				(Select if (100/count(ptd.id_paquete_turistico)*count(d.flag_playa)>=(Select value_parametro From parametros Where key_parametro = 'COMOT'),'Si', 'No') 
				from `tour` as d inner join paquete_turistico_destino_tour as ptd on (ptd.id_tour = d.id_tour)
				where ptd.id_paquete_turistico = #idPaquete#) AS playaTour, 
				
				(Select if (100/count(ptd.id_paquete_turistico)*count(d.flag_relajacion)>=(Select value_parametro From parametros Where key_parametro = 'COMOT'),'Si', 'No') 
				from `tour` as d inner join paquete_turistico_destino_tour as ptd on (ptd.id_tour = d.id_tour)
				where ptd.id_paquete_turistico = #idPaquete#) AS relajacionTour, 
				
				(Select if (100/count(ptd.id_paquete_turistico)*count(d.flag_deportes)>=(Select value_parametro From parametros Where key_parametro = 'COMOT'),'Si', 'No') 
				from `tour` as d inner join paquete_turistico_destino_tour as ptd on (ptd.id_tour = d.id_tour)
				where ptd.id_paquete_turistico = #idPaquete#) AS deportesTour, 
				
				(Select if (100/count(ptd.id_paquete_turistico)*count(d.flag_cultural)>=(Select value_parametro From parametros Where key_parametro = 'COMOT'),'Si', 'No') 
				from `tour` as d inner join paquete_turistico_destino_tour as ptd on (ptd.id_tour = d.id_tour)
				where ptd.id_paquete_turistico = #idPaquete#) AS culturalTour;
					
	</select>
		
	<select id="listarPaqueteDetail" parameterClass="paqueteResumeBean" resultMap="resultPaqueteDetail">
		SELECT 
			Distinct            
			pd.id_paquete_turistico,  
		    pturis.nombre AS paquete,
		    pturis.total_gasto AS precio,		    
		    IfNull(pturis.total_gasto,0) AS im_gasto,
			dc.descripcion AS ciudad,            
			(select t.descripcion From paquete_turistico_destino_tour AS ptt 					 
				INNER JOIN tour AS t ON (ptt.id_tour = t.id_tour)
				WHERE (pd.id_paquete_turistico = ptt.id_paquete AND pd.id_destino_ciudad = ptt.id_destino)
				LIMIT 1) AS nomTour,                
			(select h.descripcion from paquete_turistico_destino_hotel AS ph 
				INNER JOIN hotel AS h ON (ph.id_hotel=h.id_hotel)
				WHERE (pd.id_paquete_turistico = ph.id_paquete AND ph.id_destino=pd.id_destino_ciudad)
				LIMIT 1) AS nomHotel,
			(Select a.nombre from paquete_turistico_ticket AS pticket 
				INNER JOIN aerolinea AS a ON (pticket.id_aerolinea=a.id_aerolinea)
				WHERE (pticket.id_paquete_turistico=pd.id_paquete_turistico AND pticket.id_destino_destino=pd.id_destino_ciudad)
				LIMIT 1) AS nomAerolinea 
		FROM paquete_turistico_destino AS pd 
			INNER JOIN paquete_turistico AS pturis ON (pturis.id_paquete=pd.id_paquete_turistico)
			INNER JOIN destino_ciudad AS dc ON (pd.id_destino_ciudad=dc.id_destino_ciudad)	            
		WHERE 
			pd.id_paquete_turistico = #idPaquete#
	</select>
	
	<select id="listarDestinosDetail" parameterClass="cotizacionDetalleBean" resultMap="resultDestinosDetail">
		SELECT 
			c.id_cotiza_deta,
			co.id_cotiza,
			dcorigen.descripcion AS ciudad_origen, 
		    dc.descripcion AS ciudad_destino, 
		    dcorigen.codigo_iso AS iso_origen, 
    		dc.codigo_iso AS iso_destino,
    		dcorigen.id_destino_ciudad AS id_origen,
    		dc.id_destino_ciudad AS id_destino,
		    c.ti_ida, 
		    if (c.ti_ida=1,'Solo Ida','Ida y Vuelta') AS vuelo, 
		    c.fe_partida,
		    ifNull(c.fe_retorno, '0000-00-00') AS fe_retorno,
		    (ifNull(co.nu_adultos,0) + ifNull(co.nu_ninos,0)) AS cantidad
		FROM `cotizacion_deta` AS c  	
			INNER JOIN `cotizacion` AS co ON (co.nu_cotiza = c.id_cotiza)
			LEFT JOIN destino_ciudad AS dcorigen ON (c.id_destino_origen=dcorigen.id_destino_ciudad)
    		LEFT JOIN destino_ciudad AS dc ON (c.id_destino=dc.id_destino_ciudad)
		WHERE 
			c.id_cotiza = #numeroCotizacion#
	</select>
	
	<select id="getCotizacionById" parameterClass="Integer" resultMap="resultCotizacionById">
        SELECT 
            c.id_cotiza, 
            nu_cotiza, 
            case when fe_cotiza != '0000-00-00' then fe_cotiza else '' end as fe_cotiza, 
            case when fe_partida != '0000-00-00' then fe_partida else '' end as fe_partida, 
            case when fe_partida != '0000-00-00' then fe_retorno else '' end as fe_retorno, 
            observacion, 
            id_tipo_programa, 
            id_tipo_cotiza,
            e.no_estado,
            id_cliente,
            fe_max_aprob_cotiza
        FROM 
            cotizacion c inner join estado e on c.id_estado = e.id_estado
        WHERE 
            c.id_cotiza = #cotizacionId#
    </select>
    
    <select id="listarCotizacionPaqueteDestinos" parameterClass="Integer" resultMap="resultCotPatTurDestinos">
        SELECT 
            Distinct     
            co.id_cotiza, cl.id_cliente, pturis.id_paquete, cl.email,  
            co.nu_cotiza, co.fe_cotiza, cl.nombres, cl.apellidos, td.descripcion as tipo_doc, cl.nu_documento,
            pturis.fe_partida, pturis.fe_retorno,
            pturis.nombre as nombrePaqueteTuristico,
            pturis.nu_ninos, pturis.nu_adultos,
            co.im_precio,   
            pd.id_paquete_turistico,  
            dc.descripcion,
            (select t.descripcion From paquete_turistico_destino_tour AS ptt                     
                INNER JOIN tour AS t ON (ptt.id_tour = t.id_tour)
                WHERE (pd.id_paquete_turistico = ptt.id_paquete AND pd.id_destino_ciudad = ptt.id_destino)
                LIMIT 1) AS nomTour,                
            (select h.descripcion from paquete_turistico_destino_hotel AS ph 
                INNER JOIN hotel AS h ON (ph.id_hotel=h.id_hotel)
                WHERE (pd.id_paquete_turistico = ph.id_paquete AND ph.id_destino=pd.id_destino_ciudad)
                LIMIT 1) AS nomHotel,
            (Select Concat(a.nombre, ' / ') from paquete_turistico_ticket AS pticket 
                INNER JOIN aerolinea AS a ON (pticket.id_aerolinea=a.id_aerolinea)
                WHERE (pticket.id_paquete_turistico=pd.id_paquete_turistico AND pticket.id_destino_destino=pd.id_destino_ciudad)
                LIMIT 1) AS nomAerolinea,
            prov.nombre as nombreProveedor                          
        FROM paquete_turistico_destino AS pd 
            INNER JOIN cotizacion AS co ON (co.id_paquete=pd.id_paquete_turistico)
            INNER JOIN paquete_turistico AS pturis ON (pturis.id_paquete=pd.id_paquete_turistico)
            INNER JOIN destino_ciudad AS dc ON (pd.id_destino_ciudad=dc.id_destino_ciudad)            
            INNER JOIN proveedor_aerolinea_destino AS pad ON (dc.id_destino_ciudad = pad.id_destino_ciudad)
            INNER JOIN proveedor AS prov ON (pad.id_proveedor = prov.id_proveedor)
            inner join cliente cl on co.id_cliente = cl.id_cliente
            inner join tipo_documento td on cl.tipo_docu = td.id_tipo_docu
        WHERE 
            co.id_cotiza = #cotizacionId# AND co.id_tipo_cotiza=1
    </select>
    
    <select id="listarCotizacionTicketDestinos" parameterClass="Integer" resultMap="resultCotTicketDestinos">
        SELECT 
			c.id_cotiza_deta,
		    co.id_cotiza, 
			dcorigen.descripcion AS ciudad_origen, 
			dc.descripcion AS ciudad_destino, 
			dcorigen.codigo_iso AS iso_origen, 
			dc.codigo_iso AS iso_destino,
			dcorigen.id_destino_ciudad AS id_origen,
			dc.id_destino_ciudad AS id_destino,
			c.ti_ida, 
			if (c.ti_ida=1,'Solo Ida','Ida y Vuelta') AS vuelo, 
			c.fe_partida,
			c.fe_retorno,
		    co.nu_cotiza,
		    co.fe_cotiza,
		    cl.nombres, cl.apellidos, 
		    td.descripcion as tipo_doc, cl.nu_documento,
		    ifnull(co.im_precio, 0) as im_precio,
		    co.nu_adultos, co.nu_ninos,
		    cl.id_cliente, td.descripcion as tipo_doc, cl.nu_documento,
		    (Select a.nombre from cotizacion_deta_ticket AS cticket
                INNER JOIN aerolinea AS a ON (cticket.id_aerolinea=a.id_aerolinea)
                WHERE (cticket.id_cotiza=c.id_cotiza AND cticket.id_destino=dc.id_destino_ciudad)
                LIMIT 1) AS nomAerolinea
		FROM `cotizacion_deta` AS c  	
			INNER JOIN `cotizacion` AS co ON ( co.nu_cotiza=c.id_cotiza )
			LEFT JOIN destino_ciudad AS dcorigen ON (c.id_destino_origen=dcorigen.id_destino_ciudad)
			LEFT JOIN destino_ciudad AS dc ON (c.id_destino=dc.id_destino_ciudad)
		    inner join cliente cl on co.id_cliente = cl.id_cliente
		    inner join tipo_documento td on cl.tipo_docu = td.id_tipo_docu
		WHERE co.id_cotiza = #cotizacionId# AND co.id_tipo_cotiza = 2;
    </select>
	
</sqlMap>
